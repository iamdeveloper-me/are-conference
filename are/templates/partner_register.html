{% extends "layout/base.html" %}
{% load static %}
{% block extra_css %}

<link rel="stylesheet" href="{% static 'css/ourpartner.css' %}">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" ></script>
{% endblock extra_css %}


{% block content %}
<div class="black_box"></div>
<section class="registerArea">
    <div class="registerBanner">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h2>Registration Form</h2>
                    <p>Enter your details below to Registration</p>
                </div>
            </div>
        </div>
    </div>
    <div class="formBox">
        <div class="container">
            <form class = 'partner_form' id="form1" method="post" enctype='multipart/form-data'>
                {% csrf_token %}
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Email Id<span>*</span></label>
                            <input type="email" id="org_email" name="email" class="form-control" placeholder="Enter your email id..." maxlength="50" required="">
                            <div id="email-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Phone number<span>*</span></label>
                            <input type="text" id="mobileno" pattern="[0-9]{10}" name="phone_number" class="form-control" placeholder="Enter your phone number..." required="">
                            <div id="phone_number-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Name of the organization<span>*</span></label>
                            <input type="text" name="org_name" class="form-control alpha-input" placeholder="Enter organization name..." maxlength="100" maxlength="50" required="">
                            <div id="org_name-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Type of organization<span>*</span></label>
                            <div class="downArrow" >
                                  <select name="org_type">
                                     <option selected="selected">Academic</option>
                                     <option>Government</option>
                                     <option>Corporate</option>
                                     <option>NGO</option>
                                  </select>
                            </div>
                            <div id="org_type-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Organization Detail<span>*</span></label>
                            <input  name="org_detail" type="text" class="form-control"  placeholder="Enter Organization Detail....." maxlength="1000" required="" >
                            <div id="org_detail-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Year<span>*</span></label>
                            <div class="downArrow" >
                                  <select name="year">
                                     <option selected="selected">2021</option>
                                     {% for year in data.count_list %}
                                        <option>{{year}}</option>
                                     {% endfor %}
                                  </select>
                            </div>
                            <div id="year-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Password<span>*</span></label>
                            <input id="password-field" name="password" type="password" class="form-control" name="password"  placeholder="Enter password..." maxlength="25" required="" >
                            <span toggle="#password-field" class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            <div id="password-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Confirm password<span>*</span></label>
                            <input id="confirm-password-field" name="confirm_password" type="password" class="form-control" name="confirm password"  placeholder="Enter confirm password..." maxlength="25" required="" >
                            <span toggle="#confirm-password-field" class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            <div id="confirm_password-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Name of the co-ordinator<span>*</span></label>
                            <input type="text" name="coordinator_name" class="form-control alpha-input" placeholder="Enter co-ordinator name..." maxlength="25" required="">
                            <div id="coordinator_name-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Designation<span>*</span></label>
                            <input type="text" name="designation" class="form-control alpha-input" placeholder="Enter designation name..." maxlength="20" required="">
                            <div id="designation-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Upload logo of organization<span>*</span></label>
                            <input type="file" name="org_image" accept="image/png" class="form-control" placeholder="Upload logo of organization" required="">
                            <div id="org_image-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Pin code<span>*</span></label>
                            <input type="number" id="pinno" name="pincode" class="form-control" placeholder="Enter pin code..." required="">
                            <div id="pincode-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Country<span>*</span></label>
                            <input type="text" name="country" class="form-control onlyalpha" placeholder="Enter country name..." maxlength="20" required="">
                            <div id="country-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">State<span>*</span></label>
                            <input type="text" name="state" class="form-control onlyalpha" placeholder="Enter state name..."  maxlength="20" required="">
                            <div id="state-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">City<span>*</span></label>
                            <input type="text" name="city" class="form-control onlyalpha" placeholder="Enter city name..."  maxlength="20" required="">
                            <div id="city-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="exampleInputEmail1">District<span>*</span></label>
                            <input type="text" name="district" class="form-control onlyalpha" placeholder="Enter district name..." maxlength="20" required="">
                            <div id="district-error" class="invalid-feedback">Last name cannot be blank!</div>
                        </div>
                    </div>
                   
                </div>
                <Box class="RegisterBtn"><button id ="partner-button" type="button" class="partner_form1">Register</button></Box>
            </form>
        </div>
    </div>
</section>
<!--Model Popup starts-->
<div class="container"  tabindex="-1" role="dialog" aria-hidden="true" data-bs-keyboard="false" data-bs-backdrop="static">
    <div class="row">
        <a class="btn btn-primary" data-toggle="modal" href="#ignismyModal">open Popup</a>
        <div class="modal fade" id="ignismyModal" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <a href="{% url 'awards:partner' %}" title="Close" class="close">X</a>
                     </div>
                    
                    <div class="modal-body">
                       
                        <div class="thank-you-pop">
                            <img src="http://goactionstations.co.uk/wp-content/uploads/2017/03/Green-Round-Tick.png" alt="">
                            <h1>Thank You!</h1>
                            <p>Your submission is received successfully</p>
                        </div>

                         
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>
<!--Model Popup ends-->
{% endblock content %}
{% block extra_js %}
<script>
// debugger
$(document).ready(function() {
    
    // $('#ignismyModal').modal({backdrop: 'static', keyboard: false}, 'show');
    // $(".formsubmit").submit(function(event) {

    $(".alpha-input").keydown(function (e){
        var k = e.keyCode || e.which;
        // debugger
        var ok = k >= 65 && k <= 90 || // A-Z
            k >= 96 && k <= 105 || // a-z
            k >= 35 && k <= 40 || // arrows
            k == 9 || //tab
            k == 46 || //del
            k == 8 || // backspace
            k == 32 ||
            k == 190 ||
            (!e.shiftKey && k >= 48 && k <= 57); // only 0-9 (ignore SHIFT options)

        if(!ok || (e.ctrlKey && e.altKey)){
            e.preventDefault();
        }
    });

    $('#org_email').keypress(function (e) {
        var re = /([A-Z0-9a-z_-][^@])+?@[^$#<>?]+?\.[\w]{2,4}/.test(this.value);
        if(!re) {
            $('#email-error').text("Email is not correct");
            $("#email-error").addClass('d-block');
        } else {
            $("#email-error").removeClass('d-block');
        }
    })

  //   $('.onlyalpha').keydown(function (e) {
  //     if (e.shiftKey || e.ctrlKey || e.altKey) {
  //         e.preventDefault();
  //     } else {
  //         var key = e.keyCode;
  //         if (!((key == 8) || (key == 32) || (key == 46) || (key >= 35 && key <= 40) || (key >= 65 && key <= 90))) {
  //             e.preventDefault();
  //         }
  //     }
  // });
    $(".onlyalpha").keypress(function (e) {
            var keyCode = e.keyCode || e.which;
 
            // $("#lblError").html("");
 
            //Regex for Valid Characters i.e. Alphabets.
            var regex = /^[A-Za-z]+$/;
 
            //Validate TextBox value against the Regex.
            var isValid = regex.test(String.fromCharCode(keyCode));
            if (!isValid) {
                e.preventDefault()
            }
        });

    $("#pinno").keypress(function(evt){
        // debugger
        data = $(this).val();
        if (evt.which < 48 || evt.which > 57)
            {
                evt.preventDefault();
            }
        else {
            if (data.length < 5) {
                $("#pincode-error").text("Pincode must be of 6 digit")
                $("#pincode-error").addClass('d-block');
            } else if (data.length == 5) {
                $("#pincode-error").removeClass('d-block');
            } else {
                evt.preventDefault();
            }
        }
    });

    $("#mobileno").keypress(function(evt){
        // debugger
        data = $(this).val();
        if (evt.which < 48 || evt.which > 57)
            {
                evt.preventDefault();
            }
        else {
            if (data.length < 9) {
                $("#phone_number-error").text("Phone number must be of 10 digit")
                $("#phone_number-error").addClass('d-block');
            } else if (data.length == 9) {
                $("#phone_number-error").removeClass('d-block');
            } else {
                evt.preventDefault();
            }
        }
    });

    $('body').on('click',"#partner-button", function(event) {
        //stop submit the form, we will post it manually.
        $(".invalid-feedback").removeClass('d-block');
        $("#partner-button").prop("disabled", true);
        // event.preventDefault();
        // Get form
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        // debugger

        var form = $('#form1')[0];

        // Create an FormData object 
        var data = new FormData(form);
        password = data.get('password')
        confirm_password = data.get('confirm_password')
        if (password === confirm_password) {
            if (password.length < 7 && confirm_password.length < 7) {
                $("#password-error").text("password must be of atleast 8 character")
                $("#password-error").addClass('d-block');
                $("#confirm_password-error").text("confirm_password must be of atleast 8 character")
                $("#confirm_password-error").addClass('d-block');
                $("#partner-button").prop("disabled", false);
            } else {
                $.ajax({
                    type: "POST",
                    enctype: 'multipart/form-data',
                    headers: { 'X-CSRFToken': csrftoken },
                    url: "/ourpartner/register/",
                    data: data,
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 800000,
                    success: function(data) {

                        // debugger
                        if (data.status == "success") {

                            $("#partner-button").prop("disabled", false);
                            $('#ignismyModal').modal('show');

                            // $("#btnSubmit").prop("disabled", false);
                        } else if (data.status == "error") {
                            $.each(data.errors, function(key, value) {

                                $(`#${key}-error`).text(value)
                                $(`#${key}-error`).addClass('d-block');
                                // alert(key + " " + value);
                            });
                            $(`#partner-button`).prop("disabled", false);
                            $(window).scrollTop(0);
                            // $('#amg_form').find('.invalid-feedback').removeClass('d-block');
                        } else {

                            alert('error')
                        }
                    }
                });
            }
        }
        else {
            $("#password-error").text("password and confirm password must be same")
            $("#password-error").addClass('d-block');
            $("#confirm_password-error").text("password and confirm password must be same")
            $("#confirm_password-error").addClass('d-block');
            $("#partner-button").prop("disabled", false);
        }

        // formno = form_id
        // value = formno.toString().split('');
        // value1 = value[4]
        // main_id = parseInt(value1);

        // disabled the submit button

    });
});


$(".toggle-password").click(function() {

    $(this).toggleClass("fa-eye fa-eye-slash");
    var input = $($(this).attr("toggle"));
    if (input.attr("type") == "password") {
      input.attr("type", "text");
    } else {
      input.attr("type", "password");
    }
  });
</script>
  {% endblock extra_js %}